<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HACK VERSE | RED</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Orbitron', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { red: { 500: '#ef4444', 900: '#7f1d1d' } },
                    animation: { 'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite' }
                }
            }
        }
    </script>

    <style>
        body { background: #000; color: #ef4444; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        
        /* FORCE HIDDEN CLASS */
        .force-hide { display: none !important; opacity: 0 !important; pointer-events: none !important; }

        /* SPLASH SCREEN */
        #splash-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: #000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }

        .loader-ring {
            width: 80px; height: 80px;
            border: 2px solid transparent;
            border-top-color: #ef4444;
            border-right-color: #7f1d1d;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        /* EMERGENCY BUTTON */
        #force-enter-btn {
            margin-top: 30px;
            padding: 10px 20px;
            border: 1px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            opacity: 0;
            transition: opacity 1s;
            pointer-events: none;
        }
        #force-enter-btn.visible { opacity: 1; pointer-events: auto; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* MAIN UI */
        .glass-panel {
            background: rgba(20, 0, 0, 0.8);
            border: 1px solid rgba(220, 38, 38, 0.3);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="loader-ring"></div>
        <h1 class="text-2xl font-bold tracking-widest text-white font-sans">HACK VERSE</h1>
        <p class="text-xs text-red-500 mt-2 font-mono" id="loading-text">> SYSTEM_BOOT...</p>
        
        <button id="force-enter-btn" onclick="app.forceEnter()">[ TAP TO ENTER SYSTEM ]</button>
    </div>

    <div id="app-container" class="max-w-md mx-auto h-screen flex flex-col p-4 opacity-0 transition-opacity duration-1000">
        
        <header class="flex justify-between items-center mb-6 pt-2 border-b border-red-900/30 pb-4">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 border border-red-600 bg-red-900/20 flex items-center justify-center">
                    <span class="material-symbols-rounded text-red-500">terminal</span>
                </div>
                <div>
                    <h2 class="font-sans font-bold text-lg text-white">HACK VERSE</h2>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></span>
                        <span id="status-text" class="text-[10px] text-red-500">ONLINE</span>
                    </div>
                </div>
            </div>
            <div class="border border-red-800 px-2 py-1 text-xs text-red-500">
                <span id="timer">10:00</span>
            </div>
        </header>

        <div class="glass-panel p-6 rounded-lg mb-6 relative">
            <div class="absolute top-2 right-2 text-red-900/50">
                <span class="material-symbols-rounded text-4xl">fingerprint</span>
            </div>
            <span class="text-[10px] text-red-400 border border-red-900 px-1 uppercase">ID_Protocol_V9</span>
            
            <div class="mt-4 mb-6">
                <div id="inner-loader" class="flex items-center gap-2 mb-2 hidden">
                    <span class="material-symbols-rounded animate-spin text-sm text-red-500">sync</span>
                    <span class="text-xs text-red-400">CONNECTING_SERVER...</span>
                </div>

                <h1 id="email-display" onclick="app.copy()" class="text-xl font-bold text-white break-all font-mono cursor-pointer active:scale-95 transition-transform">
                    INITIALIZING...
                </h1>
                <p class="text-[10px] text-red-600 mt-2">> TAP_ADDRESS_TO_COPY</p>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="app.refreshIdentity()" class="border border-red-800 bg-black/50 text-red-500 py-3 text-xs font-bold hover:bg-red-900/20 transition-colors">
                    // NEW_ID
                </button>
                <button onclick="app.copy()" class="bg-red-700 text-white py-3 text-xs font-bold hover:bg-red-600 transition-colors shadow-[0_0_15px_rgba(220,38,38,0.4)]">
                    // COPY_HASH
                </button>
            </div>
        </div>

        <div class="flex-1 flex flex-col border-t border-red-900/30 pt-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-sans font-bold text-white">INBOX_LOGS</h3>
                <button onclick="app.fetchMessages(true)" class="text-red-500 hover:text-white">
                    <span class="material-symbols-rounded">refresh</span>
                </button>
            </div>
            
            <div id="inbox-list" class="flex-1 overflow-y-auto space-y-2">
                <div class="text-center mt-10 text-red-900/50">
                    <span class="material-symbols-rounded text-4xl">wifi_off</span>
                    <p class="text-xs mt-2">WAITING_FOR_PACKETS</p>
                </div>
            </div>
        </div>
    </div>

    <div id="detail-view" class="fixed inset-0 z-50 bg-black flex flex-col transform translate-x-full transition-transform duration-300">
        <div class="p-4 border-b border-red-900 flex justify-between bg-black">
            <button onclick="app.closeDetail()" class="text-red-500"><span class="material-symbols-rounded text-3xl">chevron_left</span></button>
            <span class="text-red-500 font-bold font-mono">DECRYPTED_MSG</span>
            <button onclick="app.deleteMsg()" class="text-red-800"><span class="material-symbols-rounded">delete</span></button>
        </div>
        <div class="p-6 overflow-y-auto text-gray-300 font-mono text-sm">
            <h2 id="d-subject" class="text-xl text-white font-bold mb-4">Subject</h2>
            <div class="border-b border-red-900/30 pb-4 mb-4">
                <p id="d-from" class="text-red-400 text-xs">Sender</p>
                <p id="d-date" class="text-red-800 text-[10px]">Time</p>
            </div>
            <div id="d-body" class="prose prose-invert"></div>
        </div>
    </div>

    <a href="https://whatsapp.com/channel/0029Vb0FDlJ96H4bfi55nK3c" target="_blank" class="fixed bottom-6 right-6 z-40 group">
        <div class="absolute inset-0 bg-red-600 blur opacity-30 animate-pulse-fast rounded-full"></div>
        <div class="relative w-14 h-14 bg-black border border-red-500 rounded-full flex items-center justify-center shadow-[0_0_10px_#ef4444]">
            <svg class="w-6 h-6 fill-red-500" viewBox="0 0 24 24"><path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.711 2.592 2.654-.698c1.009.575 2.173.894 3.428.895 3.183 0 5.768-2.586 5.768-5.766 0-3.181-2.585-5.767-5.768-5.767zm.6 1.116c2.569 0 4.659 2.09 4.659 4.659 0 2.564-2.095 4.659-4.659 4.659-1.299 0-2.481-.527-3.333-1.385l-1.325.348.356-1.32c-.896-.892-1.458-2.126-1.458-3.483 0-2.564 2.095-4.659 4.659-4.659z"/></svg>
        </div>
    </a>

    <div id="toast" class="fixed top-5 left-1/2 -translate-x-1/2 bg-black border border-red-600 text-red-500 px-4 py-2 text-xs font-mono rounded shadow-lg transform -translate-y-20 transition-transform duration-300 z-[100]">
        > ALERT: <span id="toast-msg">...</span>
    </div>

    <script>
        const API = 'https://api.mail.tm';

        const app = {
            state: { token: null, account: null, timer: 600, messages: [], currentId: null },

            init() {
                // 1. SAFETY TIMER: If app stuck, show Force Button after 3s
                setTimeout(() => {
                    const btn = document.getElementById('force-enter-btn');
                    const txt = document.getElementById('loading-text');
                    if(document.getElementById('splash-screen').style.display !== 'none') {
                        btn.classList.add('visible');
                        txt.innerText = "> CONNECTION_SLOW. TAP TO BYPASS.";
                        txt.style.color = "yellow";
                    }
                }, 3000);

                // 2. Normal Auto-Start
                setTimeout(() => {
                    this.forceEnter();
                }, 2000);
            },

            forceEnter() {
                // Hide Splash
                const splash = document.getElementById('splash-screen');
                const main = document.getElementById('app-container');
                
                splash.style.opacity = '0';
                setTimeout(() => splash.style.display = 'none', 500);
                
                main.style.opacity = '1';
                document.body.style.overflow = 'auto'; // Re-enable scroll

                // Start API in Background (Won't block UI)
                this.createAccount();
                this.startTimer();
                setInterval(() => this.fetchMessages(), 5000);
            },

            // --- API LOGIC ---
            async request(endpoint, method = 'GET', body = null) {
                try {
                    const headers = { 'Content-Type': 'application/json' };
                    if (this.state.token) headers['Authorization'] = `Bearer ${this.state.token}`;
                    const res = await fetch(`${API}${endpoint}`, { method, headers, body: JSON.stringify(body) });
                    if (!res.ok) throw new Error('Err');
                    if (method === 'DELETE') return true;
                    return await res.json();
                } catch (e) { return null; }
            },

            async createAccount() {
                const loader = document.getElementById('inner-loader');
                const status = document.getElementById('status-text');
                const display = document.getElementById('email-display');
                
                loader.classList.remove('hidden');
                display.style.opacity = '0.5';

                // Robust Retry for Domain
                let domains = await this.request('/domains');
                if(!domains) { await new Promise(r => setTimeout(r, 1000)); domains = await this.request('/domains'); }

                if (!domains || !domains['hydra:member']) {
                    display.innerText = "SERVER_OFFLINE";
                    display.style.color = "red";
                    status.innerText = "OFFLINE";
                    loader.classList.add('hidden');
                    this.showToast("API Connection Failed");
                    return;
                }

                const domain = domains['hydra:member'][0].domain;
                const user = 'hv' + Math.random().toString(36).substring(6);
                const pass = Math.random().toString(36).substring(2);
                const address = `${user}@${domain}`;

                const acc = await this.request('/accounts', 'POST', { address, password: pass });
                if (acc) {
                    const tokenData = await this.request('/token', 'POST', { address, password: pass });
                    if (tokenData) {
                        this.state.token = tokenData.token;
                        this.state.account = acc;
                        display.innerText = address;
                        display.style.opacity = '1';
                        display.style.color = "white";
                        this.showToast("Identity Encrypted");
                    }
                }
                loader.classList.add('hidden');
                this.state.timer = 600;
            },

            async refreshIdentity() {
                if(this.state.account) await this.request(`/accounts/${this.state.account.id}`, 'DELETE');
                this.state.token = null;
                this.state.messages = [];
                document.getElementById('inbox-list').innerHTML = '';
                this.createAccount();
            },

            async fetchMessages(manual = false) {
                if (!this.state.token) return;
                const data = await this.request('/messages');
                if (data && data['hydra:member']) {
                    const newMsgs = data['hydra:member'];
                    if(newMsgs.length > this.state.messages.length && !manual) this.showToast("Packet Received");
                    this.state.messages = newMsgs;
                    this.renderInbox();
                }
            },

            renderInbox() {
                const list = document.getElementById('inbox-list');
                if (this.state.messages.length === 0) {
                    list.innerHTML = `<div class="text-center mt-10 text-red-900/50"><span class="material-symbols-rounded text-4xl">wifi_off</span><p class="text-xs mt-2">NO_DATA_PACKETS</p></div>`;
                    return;
                }
                list.innerHTML = this.state.messages.map(msg => `
                    <div onclick="app.openMsg('${msg.id}')" class="bg-red-900/10 border-l-2 border-red-600 p-3 mb-2 cursor-pointer hover:bg-red-900/20">
                        <div class="flex justify-between"><span class="font-bold text-white text-xs">${msg.from.name||'Unknown'}</span><span class="text-[10px] text-red-500">${new Date(msg.createdAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span></div>
                        <div class="text-xs text-gray-400 truncate mt-1">${msg.subject}</div>
                    </div>`).join('');
            },

            async openMsg(id) {
                const msg = this.state.messages.find(m => m.id === id);
                if (!msg) return;
                this.state.currentId = id;
                document.getElementById('detail-view').classList.remove('translate-x-full');
                document.getElementById('d-subject').innerText = msg.subject;
                document.getElementById('d-from').innerText = msg.from.address;
                document.getElementById('d-date').innerText = new Date(msg.createdAt).toLocaleString();
                document.getElementById('d-body').innerHTML = '<div class="text-center py-10 text-red-500 animate-pulse">DECRYPTING...</div>';
                const full = await this.request(`/messages/${id}`);
                if (full) document.getElementById('d-body').innerHTML = full.html || full.text.replace(/\n/g, '<br>');
            },

            closeDetail() { document.getElementById('detail-view').classList.add('translate-x-full'); },
            async deleteMsg() {
                if(!this.state.currentId) return;
                await this.request(`/messages/${this.state.currentId}`, 'DELETE');
                this.state.messages = this.state.messages.filter(m => m.id !== this.state.currentId);
                this.renderInbox();
                this.closeDetail();
                this.showToast("Data Purged");
            },

            startTimer() {
                setInterval(() => {
                    this.state.timer--;
                    if(this.state.timer <= 0) this.refreshIdentity();
                    const m = Math.floor(this.state.timer / 60).toString().padStart(2, '0');
                    const s = (this.state.timer % 60).toString().padStart(2, '0');
                    document.getElementById('timer').innerText = `${m}:${s}`;
                }, 1000);
            },

            copy() {
                const text = document.getElementById('email-display').innerText;
                if(text.includes('...')) return;
                const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select();
                try { document.execCommand('copy'); this.showToast("Address Copied"); } catch(e){}
                document.body.removeChild(el);
            },

            showToast(msg) {
                const t = document.getElementById('toast');
                document.getElementById('toast-msg').innerText = msg;
                t.classList.remove('-translate-y-20');
                setTimeout(() => t.classList.add('-translate-y-20'), 3000);
            }
        };

        window.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
